<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Admin - Guru Berbagi Selogiri</title>
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap');
    
    :root { 
      --primary: #2D8B83; 
      --primary-dark: #1F6660;
      --accent: #f59e0b;
      --bg-body: #f8fafc; 
      --text-main: #1e293b;
      --text-muted: #64748b;
    }

    body { background-color: var(--bg-body); font-family: 'Plus Jakarta Sans', sans-serif; color: var(--text-main); font-size: 0.9rem; padding-bottom: 80px; }

    /* NAVBAR */
    .navbar { z-index: 1000; position: sticky; top: 0; background: #fff; border-bottom: 1px solid #e2e8f0; }
    .brand-container { display: flex; align-items: center; gap: 12px; }
    .brand-text { display: flex; flex-direction: column; justify-content: center; line-height: 1.1; }
    .brand-main { font-weight: 800; color: var(--primary); font-size: 1.4rem; letter-spacing: -0.5px; }
    .brand-sub { font-weight: 600; color: var(--text-muted); font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.5px; }

    /* DASHBOARD */
    .dashboard-header { background: #fff; padding: 20px; border-radius: 16px; border: 1px solid #e2e8f0; margin-bottom: 24px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.02); }
    
    .stat-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; margin-bottom: 24px; }
    .stat-widget { position: relative; overflow: hidden; padding: 24px; border-radius: 16px; border: none; color: white; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); transition: transform 0.2s; }
    .stat-widget:hover { transform: translateY(-5px); }
    
    .stat-total { background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); }
    .stat-approved { background: linear-gradient(135deg, #10b981 0%, #059669 100%); }
    .stat-pending { background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); }
    .stat-users { background: linear-gradient(135deg, #64748b 0%, #475569 100%); }

    .stat-val { font-size: 2.5rem; font-weight: 800; line-height: 1; margin-bottom: 4px; position: relative; z-index: 2; }
    .stat-label { font-size: 0.8rem; font-weight: 600; opacity: 0.9; text-transform: uppercase; letter-spacing: 0.5px; position: relative; z-index: 2; }
    .stat-icon-bg { position: absolute; right: -10px; bottom: -10px; font-size: 5rem; opacity: 0.2; transform: rotate(-15deg); z-index: 1; }
    
    .pretty-table { width: 100%; border-collapse: collapse; }
    .pretty-table thead th { background: #f8fafc; color: #64748b; font-size: 0.7rem; font-weight: 800; text-transform: uppercase; padding: 16px; border-bottom: 2px solid #e2e8f0; letter-spacing: 0.5px; }
    .pretty-table tbody td { padding: 14px 16px; vertical-align: middle; border-bottom: 1px solid #f1f5f9; font-size: 0.85rem; }
    
    .avatar-circle { width: 36px; height: 36px; border-radius: 50%; background: #e0f2f1; color: var(--primary); display: flex; align-items: center; justify-content: center; font-weight: 800; font-size: 0.9rem; }
    .btn-soft { width: 34px; height: 34px; border-radius: 10px; display: inline-flex; align-items: center; justify-content: center; border: none; transition: 0.2s; margin-left: 4px; }
    .btn-soft-primary { background: #e0f2f1; color: #00695c; }
    .btn-soft-primary:hover { background: var(--primary); color: white; transform: translateY(-2px); }
    .btn-soft-danger { background: #fee2e2; color: #991b1b; }
    .btn-soft-danger:hover { background: #ef4444; color: white; transform: translateY(-2px); }

    .rank-badge { width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; border-radius: 50%; font-weight: 800; font-size: 0.8rem; }
    .rank-1 { background: #fef3c7; color: #d97706; border: 1px solid #fcd34d; }
    .rank-2 { background: #f1f5f9; color: #64748b; border: 1px solid #cbd5e1; }
    .rank-3 { background: #fff7ed; color: #c2410c; border: 1px solid #fdba74; }
    .rank-other { background: #f8fafc; color: #94a3b8; font-size: 0.75rem; }

    .admin-only { display: none !important; }
    .d-none { display: none !important; }
  </style>
</head>
<body>

  <!-- NAVBAR -->
  <nav class="navbar">
    <div class="container d-flex flex-column flex-md-row gap-3 justify-content-between align-items-center">
      <div class="brand-container">
        <a href="index.html" class="text-decoration-none d-flex align-items-center gap-2">
            <div class="bg-primary text-white rounded p-1"><i class="fas fa-arrow-left"></i></div>
        </a>
        <div class="brand-text ms-2"><div class="brand-main">ADMINISTRATOR</div><div class="brand-sub">Korwilcambidik Kecamatan Selogiri</div></div>
      </div>
      
      <div class="d-flex align-items-center gap-2">
        <div class="text-end lh-1"><div id="uName" class="fw-bold text-dark" style="font-size:0.85rem;">User</div><div id="uRole" class="badge bg-danger" style="font-size:0.55rem;">ADMIN</div></div>
        <button onclick="logout()" class="btn btn-light btn-sm rounded-circle border text-danger" title="Logout"><i class="fas fa-power-off"></i></button>
      </div>
    </div>
  </nav>

  <!-- VIEW: ADMIN DASHBOARD -->
  <div class="container mt-4 fade-in">
    <div class="dashboard-header">
      <div><h4 class="fw-800 mb-0 text-dark">Dashboard Admin</h4><small class="text-muted">Kelola data dan kurasi karya guru</small></div>
    </div>
    
    <div class="stat-grid">
      <div class="stat-widget stat-total"><div class="stat-val" id="statTotal">0</div><div class="stat-label">Total Karya</div><i class="fas fa-layer-group stat-icon-bg"></i></div>
      <div class="stat-widget stat-approved"><div class="stat-val" id="statApproved">0</div><div class="stat-label">Disetujui</div><i class="fas fa-check-double stat-icon-bg"></i></div>
      <div class="stat-widget stat-pending"><div class="stat-val" id="statPending">0</div><div class="stat-label">Menunggu</div><i class="fas fa-clock stat-icon-bg"></i></div>
      <div class="stat-widget stat-users admin-only"><div class="stat-val" id="statUsers">0</div><div class="stat-label">Guru Terdaftar</div><i class="fas fa-users stat-icon-bg"></i></div>
    </div>
    
    <div class="bg-white p-4 border rounded-4 shadow-sm">
      <ul class="nav nav-tabs mb-4 border-bottom-0" id="adminTabs">
        <li class="nav-item"><button class="nav-link active fw-bold border" data-bs-toggle="tab" data-bs-target="#tab-media">Kurasi Karya</button></li>
        <li class="nav-item admin-only ms-2"><button class="nav-link fw-bold border" data-bs-toggle="tab" data-bs-target="#tab-users" onclick="loadUserList()">Manajemen Akun</button></li>
        <li class="nav-item admin-only ms-2"><button class="nav-link fw-bold border" data-bs-toggle="tab" data-bs-target="#tab-rank-school" onclick="loadSchoolStats()">Top Sekolah</button></li>
        <li class="nav-item admin-only ms-2"><button class="nav-link fw-bold border" data-bs-toggle="tab" data-bs-target="#tab-rank-teacher" onclick="loadTeacherStats()">Top Guru</button></li>
      </ul>

      <div class="tab-content">
        <div class="tab-pane fade show active" id="tab-media">
          <input type="text" class="form-control rounded-pill px-4 mb-3 border-secondary bg-light" placeholder="Cari karya di database..." oninput="searchAdminTable(this.value)">
          <div class="table-responsive rounded-3 border">
            <table class="table pretty-table table-hover align-middle mb-0">
              <thead><tr><th class="ps-3">INFO KARYA</th><th>GURU</th><th class="text-center">STATUS</th><th class="text-center">AKSI</th></tr></thead>
              <tbody id="tableMedia"></tbody>
            </table>
          </div>
        </div>
        
        <div class="tab-pane fade" id="tab-users">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <h6 class="fw-bold text-muted mb-0 ps-2">Daftar Guru Terdaftar</h6>
            <button class="btn btn-primary btn-sm rounded-pill fw-bold px-4 shadow-sm" onclick="resetUserForm(); showModalInputUser()"><i class="fas fa-plus me-2"></i>Tambah Guru</button>
          </div>
          <div class="table-container table-responsive rounded-3 border">
            <table class="table pretty-table table-hover align-middle mb-0">
              <thead><tr><th class="ps-4">NAMA GURU</th><th class="text-center">PRODUKTIVITAS</th><th>PIN AKSES</th><th>PERAN</th><th class="text-center">AKSI</th></tr></thead>
              <tbody id="tableUsers"></tbody>
            </table>
          </div>
        </div>

        <div class="tab-pane fade" id="tab-rank-school">
           <div class="d-flex justify-content-between align-items-center mb-3">
              <h6 class="fw-bold text-muted mb-0 ps-2">üèÜ Peringkat Satuan Pendidikan</h6>
              <button class="btn btn-outline-success btn-sm rounded-pill fw-bold px-3" onclick="loadSchoolStats()"><i class="fas fa-sync-alt me-1"></i> Refresh</button>
           </div>
           <div class="table-responsive rounded-3 border">
              <table class="table pretty-table table-hover align-middle mb-0">
                 <thead class="bg-light">
                    <tr>
                       <th class="text-center" style="width: 50px;">#</th>
                       <th class="ps-3">SATUAN PENDIDIKAN</th>
                       <th class="text-center">JML GURU</th>
                       <th class="text-center">TOTAL KARYA</th>
                       <th class="text-center">PERSENTASE</th>
                    </tr>
                 </thead>
                 <tbody id="tableRankSchool"></tbody>
              </table>
           </div>
        </div>

        <div class="tab-pane fade" id="tab-rank-teacher">
           <div class="d-flex justify-content-between align-items-center mb-3">
              <h6 class="fw-bold text-muted mb-0 ps-2">ü•á Top Kontributor Guru (100 Teratas)</h6>
              <button class="btn btn-outline-success btn-sm rounded-pill fw-bold px-3" onclick="loadTeacherStats()"><i class="fas fa-sync-alt me-1"></i> Refresh</button>
           </div>
           <div class="table-responsive rounded-3 border">
              <table class="table pretty-table table-hover align-middle mb-0">
                 <thead class="bg-light">
                    <tr>
                       <th class="text-center" style="width: 50px;">#</th>
                       <th class="ps-3">NAMA GURU</th>
                       <th class="ps-3">UNIT KERJA</th>
                       <th class="text-center">TOTAL KARYA</th>
                       <th class="text-center">MEDALI</th>
                    </tr>
                 </thead>
                 <tbody id="tableRankTeacher"></tbody>
              </table>
           </div>
        </div>

      </div>
    </div>
  </div>

  <!-- MODAL: KURASI -->
  <div class="modal fade" id="modalKurasi" tabindex="-1"><div class="modal-dialog modal-dialog-centered"><div class="modal-content border-0 rounded-4 shadow"><div class="modal-header border-bottom-0"><h5 class="fw-bold text-primary">Kurasi Karya</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><input type="hidden" id="kurasiId"><div class="mb-3"><label class="small fw-bold">Status Persetujuan</label><select id="kurasiStatus" class="form-select"><option value="BARU">BARU (Pending)</option><option value="DISETUJUI">DISETUJUI (Tampil)</option><option value="REVISI">REVISI (Perlu Perbaikan)</option></select></div><div class="mb-3"><label class="small fw-bold">Catatan / Feedback</label><textarea id="kurasiFeedback" class="form-control" rows="4" placeholder="Tulis masukan untuk guru..."></textarea></div></div><div class="modal-footer border-top-0"><button onclick="simpanKurasi()" class="btn btn-primary w-100 fw-bold rounded-pill">UPDATE STATUS</button></div></div></div></div>

  <!-- MODAL: USER -->
  <div class="modal fade" id="modalUser" tabindex="-1"><div class="modal-dialog modal-dialog-centered"><div class="modal-content border-0 rounded-4 shadow"><div class="modal-header"><h5 class="fw-bold text-primary">Data Guru</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><form id="formUser"><input type="hidden" id="userMode" value="ADD"><input type="hidden" id="oldPin"><div class="mb-3"><label class="small fw-bold">Nama Lengkap</label><input type="text" id="userName" class="form-control"></div><div class="mb-3"><label class="small fw-bold">Unit Kerja (Sekolah)</label><input type="text" id="userSchool" class="form-control"></div><div class="row"><div class="col-6"><label class="small fw-bold">PIN Login</label><input type="text" id="userPin" class="form-control"></div><div class="col-6"><label class="small fw-bold">Hak Akses</label><select id="userRole" class="form-select"><option value="GURU">GURU</option><option value="MODERATOR">MODERATOR</option><option value="ADMIN">ADMIN</option></select></div></div></form></div><div class="modal-footer"><button onclick="prosesSimpanUser()" class="btn btn-primary w-100 fw-bold rounded-pill">SIMPAN DATA</button></div></div></div></div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  
  <script>
    const API_URL = "https://script.google.com/macros/s/AKfycbxCTYyM2VjFQzfLKKIcYevkivH4TerMrU7jYakvJxR75_yXULW_YmKFy7nYrdBhnOAq/exec";
    const CACHE_KEY_DATA = 'guruBerbagi_data_cache';
    const CACHE_DURATION = 5 * 60 * 1000;

    var STATE = { 
        allMedia: [], users: [], 
        user: { name: "Tamu", role: "GUEST", school: "-" }
    };

    // --- API HANDLER ---
    async function callApi(action, payload = null) {
      try {
        if (action === 'read') {
           const cached = localStorage.getItem(CACHE_KEY_DATA);
           if (cached) {
               const { timestamp, data } = JSON.parse(cached);
               if (new Date().getTime() - timestamp < CACHE_DURATION) return data;
           }
           var response = await fetch(API_URL + "?action=read");
           var json = await response.json();
           if(json.status === 'success') {
               try { localStorage.setItem(CACHE_KEY_DATA, JSON.stringify({ timestamp: new Date().getTime(), data: json })); } catch(e) {}
           }
           return json;
        } else {
           if(['simpan', 'hapus', 'updateKurasi', 'hapusUser', 'simpanUser'].includes(action)) localStorage.removeItem(CACHE_KEY_DATA);
           var response = await fetch(API_URL, {
             method: "POST",
             body: JSON.stringify({ action: action, payload: payload })
           });
           return await response.json();
        }
      } catch (e) { console.error("API Error:", e); return { status: "error", message: e.toString() }; }
    }

    // INIT
    window.onload = function() { initApp(); };
    function initApp() {
      try { 
          var saved = localStorage.getItem('guruBerbagiUser'); 
          if (saved) { 
              STATE.user = JSON.parse(saved); 
              if(STATE.user.role !== 'ADMIN' && STATE.user.role !== 'MODERATOR') {
                  window.location.href = 'index.html'; // Redirect if not admin
              }
              updateUserInterface(); 
          } else {
              window.location.href = 'index.html';
          }
      } catch(e) { window.location.href = 'index.html'; }
      loadData();
    }

    function cleanStr(str) { if(!str) return ""; return str.toString().replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;").replace(/'/g, "&#039;").replace(/\n/g, " "); }
    
    function updateUserInterface() {
      document.getElementById('uName').innerText = STATE.user.name;
      document.getElementById('uRole').innerText = STATE.user.role;
      var adminOnlyEls = document.querySelectorAll('.admin-only');
      adminOnlyEls.forEach(function(el) { 
           el.style.setProperty('display', STATE.user.role === 'ADMIN' ? 'block' : 'none', 'important'); 
      });
    }

    function loadData() {
      callApi('read').then(function(res) {
        if(res && res.status === "success") {
          STATE.allMedia = res.media;
          document.getElementById('statTotal').innerText = res.media.length;
          document.getElementById('statPending').innerText = res.media.filter(function(i){ return i[9] === "BARU" }).length;
          document.getElementById('statApproved').innerText = res.media.filter(function(i){ return i[9] === "DISETUJUI" }).length;
          renderTableAdmin(STATE.allMedia);
        }
      });
    }

    function renderTableAdmin(data) {
      var html = '';
      data.forEach(item => {
        var st = item[9], badge = st === 'DISETUJUI' ? 'bg-success' : (st === 'REVISI' ? 'bg-danger' : 'bg-warning text-dark');
        html += `<tr><td class="ps-3"><div class="fw-bold text-dark">${cleanStr(item[5])}</div><div class="small text-muted">${cleanStr(item[11])}</div></td>
        <td><div class="fw-bold">${cleanStr(item[1])}</div><div class="small">${cleanStr(item[2])}</div></td>
        <td class="text-center"><span class="badge ${badge}">${st}</span></td>
        <td class="text-center"><div class="d-flex justify-content-center gap-1"><button onclick="bukaKurasi('${item[13]}','${item[9]}','${cleanStr(item[12])}')" class="btn-soft btn-soft-primary"><i class="fas fa-edit"></i></button><button onclick="hapusKarya('${item[13]}')" class="btn-soft btn-soft-danger"><i class="fas fa-trash"></i></button></div></td></tr>`;
      });
      document.getElementById('tableMedia').innerHTML = html;
    }
    
    function searchAdminTable(val) { var q = val.toLowerCase(); renderTableAdmin(STATE.allMedia.filter(i => (i[5]||"").toLowerCase().includes(q) || (i[1]||"").toLowerCase().includes(q))); }
    
    function hapusKarya(id) { 
        Swal.fire({title:'Hapus?',icon:'warning',showCancelButton:true}).then(r=>{ if(r.isConfirmed) { callApi('hapus', {id: id}).then(function(){ loadData() }); } });
    }

    function bukaKurasi(id,st,fb) { document.getElementById('kurasiId').value=id; document.getElementById('kurasiStatus').value=st; document.getElementById('kurasiFeedback').value=fb; new bootstrap.Modal('#modalKurasi').show(); }
    function simpanKurasi() { callApi('updateKurasi', { id: document.getElementById('kurasiId').value, status: document.getElementById('kurasiStatus').value, feedback: document.getElementById('kurasiFeedback').value }).then(function(){ Swal.fire('Sukses','','success');loadData();bootstrap.Modal.getInstance(document.getElementById('modalKurasi')).hide(); }); }
    
    function showModalInputUser() { new bootstrap.Modal(document.getElementById('modalUser')).show(); }

    function loadUserList() { 
        if(STATE.user.role!=='ADMIN') return; 
        var karyaCount = {};
        STATE.allMedia.forEach(m => { var n = m[1]; karyaCount[n] = (karyaCount[n] || 0) + 1; });

        callApi('users').then(function(res){
            STATE.users=res.data; 
            var h=''; 
            document.getElementById('statUsers').innerText = STATE.users.length;
            STATE.users.forEach(u=>{ 
                var nama = u[0], jml = karyaCount[nama] || 0, badgeRole = u[3]==='ADMIN'?'bg-danger':'bg-secondary';
                h+=`<tr>
                <td><div class="d-flex align-items-center"><div class="avatar-circle me-3">${nama.charAt(0)}</div><div><div class="fw-bold">${cleanStr(nama)}</div><small class="text-muted">${cleanStr(u[1])}</small></div></div></td>
                <td class="text-center"><span class="badge bg-light text-dark border px-3">${jml} Karya</span></td>
                <td class="font-monospace fw-bold text-muted">${u[2]}</td>
                <td><span class="badge ${badgeRole}">${u[3]}</span></td>
                <td class="text-center"><div class="d-flex justify-content-center gap-1"><button onclick="hapusUser('${u[2]}')" class="btn-soft btn-soft-danger"><i class="fas fa-trash"></i></button></div></td>
                </tr>`; 
            }); 
            document.getElementById('tableUsers').innerHTML=h; 
        });
    }
    
    function loadSchoolStats() {
        if(!STATE.users || STATE.users.length === 0) { callApi('users').then(function(res){ STATE.users = res.data; processSchoolStats(); }); } else { processSchoolStats(); }
    }

    function processSchoolStats() {
        var stats = {}; var totalKaryaSemua = STATE.allMedia.length;
        STATE.users.forEach(u => { var s = u[1] || "Tanpa Satuan Pendidikan"; if(!stats[s]) stats[s] = { guru: 0, karya: 0 }; stats[s].guru++; });
        STATE.allMedia.forEach(m => { var s = m[2] || "Tanpa Satuan Pendidikan"; if(!stats[s]) stats[s] = { guru: 0, karya: 0 }; stats[s].karya++; });

        var arr = Object.keys(stats).map(k => { return { nama: k, guru: stats[k].guru, karya: stats[k].karya, persen: totalKaryaSemua > 0 ? ((stats[k].karya / totalKaryaSemua) * 100).toFixed(1) : 0 }; });
        arr.sort((a, b) => b.karya - a.karya || b.guru - a.guru);

        var h = '';
        arr.forEach((x, idx) => {
            var barColor = x.persen > 50 ? 'bg-success' : (x.persen > 20 ? 'bg-primary' : 'bg-warning');
            var badgeRank = idx < 3 ? `<div class="rank-badge rank-${idx+1}">${idx+1}</div>` : `<div class="rank-badge rank-other">${idx+1}</div>`;
            h += `<tr>
                <td class="text-center align-middle">${badgeRank}</td>
                <td class="ps-3 fw-bold text-dark">${cleanStr(x.nama)}</td>
                <td class="text-center"><span class="badge bg-soft-blue text-dark fw-bold" style="font-size:0.9rem">${x.guru}</span></td>
                <td class="text-center"><span class="badge bg-soft-teal text-dark fw-bold" style="font-size:0.9rem">${x.karya}</span></td>
                <td class="text-center" style="width:20%"><div class="d-flex align-items-center gap-2"><div class="progress flex-grow-1" style="height: 6px;"><div class="progress-bar ${barColor}" role="progressbar" style="width: ${x.persen}%"></div></div><small class="fw-bold text-muted">${x.persen}%</small></div></td>
            </tr>`;
        });
        if(arr.length === 0) h = `<tr><td colspan="5" class="text-center py-4 text-muted">Belum ada data statistik.</td></tr>`;
        document.getElementById('tableRankSchool').innerHTML = h;
    }

    function loadTeacherStats() {
        var teacherCounts = {};
        STATE.allMedia.forEach(m => { var n = m[1]; var s = m[2]; if(!teacherCounts[n]) teacherCounts[n] = {name: n, school: s, count: 0}; teacherCounts[n].count++; });
        var arr = Object.values(teacherCounts); arr.sort((a, b) => b.count - a.count);
        var h = '';
        arr.slice(0, 100).forEach((t, idx) => {
            var medal = idx === 0 ? 'ü•á' : (idx === 1 ? 'ü•à' : (idx === 2 ? 'ü•â' : ''));
            var badgeRank = idx < 3 ? `<div class="rank-badge rank-${idx+1}">${idx+1}</div>` : `<div class="rank-badge rank-other">${idx+1}</div>`;
            h += `<tr><td class="text-center align-middle">${badgeRank}</td><td class="ps-3 fw-bold text-dark">${cleanStr(t.name)} ${medal}</td><td class="ps-3 text-muted small">${cleanStr(t.school)}</td><td class="text-center"><span class="badge bg-soft-teal text-dark fw-bold" style="font-size:0.9rem">${t.count}</span></td><td class="text-center" style="font-size:1.2rem;">${medal}</td></tr>`;
        });
        if(arr.length === 0) h = `<tr><td colspan="5" class="text-center py-4 text-muted">Belum ada data guru.</td></tr>`;
        document.getElementById('tableRankTeacher').innerHTML = h;
    }
    
    function resetUserForm() { document.getElementById('formUser').reset(); document.getElementById('userMode').value="ADD"; }
    function prosesSimpanUser() { 
        var p={nama:document.getElementById('userName').value,sekolah:document.getElementById('userSchool').value,pin:document.getElementById('userPin').value,role:document.getElementById('userRole').value,oldPin:document.getElementById('oldPin').value}; 
        callApi('simpanUser', p).then(function(res){ if(res.status==='success'){ Swal.fire('Sukses','','success'); loadUserList(); bootstrap.Modal.getInstance(document.getElementById('modalUser')).hide(); } else { Swal.fire('Error',res.message,'error'); } });
    }
    function hapusUser(p) { Swal.fire({title:'Hapus User?',icon:'warning',showCancelButton:true}).then(r=>{if(r.isConfirmed) callApi('hapusUser', {pin: p}).then(function(){ loadUserList() }); });}
    
    function logout() { localStorage.removeItem('guruBerbagiUser'); window.location.href = 'index.html'; }
  </script>
</body>
</html>